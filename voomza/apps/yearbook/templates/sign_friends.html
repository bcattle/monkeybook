{% extends 'two_page.html' %}
{% load staticfiles %}
{% load url from future %}

{% block style %}
    <link href="{% static 'css/sign_friends.css' %}" rel="stylesheet">
{% endblock %}

{% block page_header %}
    <div class="book_topsection">
        <div class="book_topsection_upper">
            <img class="booklogo" src="{% static 'img/logo2_white.png' %}">
            <div class="booktopright">
                <div class="floatright">
                    <button class="btn btn-medium btn-primary">Preview my Yearbook</button>
                </div>
                <div class="floatright">
                    <h2 style="margin:0;">jquery plugin</h2>
                </div>
            </div>
        </div>
        <div style="clear:both;"></div>
        <h1 class="regularfont googlefont bookheader_center">Congrats, your Yearbook has been wrapped!</h1>
        <div class="book_subheader">
            <img class="helper_3" src="{% static 'img/yearbook_staff_100.jpg' %}">
            <p class="helpertext_3">We keep it wrapped until Yearbook Day, Monday,
                December 10th, so that your friends have a chance to sign it. Visit
                <a href="http://www.yearbookallstar.com/">yearbookallstar.com</a>
                at any time to come back to this page and see who's signed!</p>
            <div style="clear:both;"></div>
        </div>
    </div>
{% endblock %}

{# -- PAGES -- #}

{% block page_1 %}
    <div class="page_content">
        <h3 class="page_header">Who signed your yearbook?</h3>
        <div class="page_pane">
            <div class="signs_list">

            </div>
        </div>
        <div style="clear:both;"></div>
    </div>
{% endblock %}

{% block page_2 %}
    <div class="page_content">
        <h3 class="page_header">Sign and they'll sign back!</h3>
        <div class="page_pane">
            <div class="page_pane_header">
                <input id="filter_input" type="text" placeholder="type to find a friend">
            </div>
            <div class="yearbooks_list">

            </div>
        </div>
    </div>
{% endblock %}


{% block script %}
    {# yepnope, jQuery and Mustache loaded in two_page.html   #}
    <script type="text/html" id="sign_template">
        <div class="friend_sign_unit">
            <div class="friend_sign_photo">
                <img src="[[ pic ]]">
            </div>
            <div class="friend_sign_content">
                <div class="friend_sign_text googlefont">[[ name ]]</div>
                <div class="sign_buttons_tray">
                    <button class="btn btn-mini btn-info googlefont friend_sign_button viewSignBtn"
                            data-id="[[ id ]]">View Message</button>
                    [[#can_sign]]
                        <button class="btn btn-mini googlefont friend_sign_button newSignBtn"
                                data-id="[[ id ]]">Sign Yearbook</button>
                    [[/can_sign]]
                </div>
            </div>
            <div style="clear:both;"></div>
        </div>
    </script>
    <script type="text/html" id="yearbook_template">
        <div class="yearbook">
            <div class="yearbook_content">
                <div class="yearbook_photo">
                    <img src="[[ pic ]]">
                </div>
                <div class="yearbook_input_container">
                    <div class="yearbook_name googlefont">To [[ name ]]:</div>
                    <textarea class="yearbook_input" placeholder="Sign [[ first_name ]]'s yearbook"></textarea>
                </div>
                <div style="clear:both;"></div>
            </div>
            <div class="yearbook_footer">
                {# TODO user's photo? #}
                <button class="btn btn-mini btn-primary signYearbookButton" data-id="[[ id ]]">Sign Yearbook</button>
                <div style="clear:both;"></div>
            </div>
        </div>
    </script>
    <script type="text/javascript">
        $(document).ready(function(){
            Mustache.tags = ['[[', ']]'];
            // Inject two dummy signs
            var s1 = {
                'name': 'Ethan Montoya',
                'pic': '{% static 'img/yearbook_stacy.png' %}',
                'id': 1000424,
                'can_sign': true
            };
            var s2 = {
                'name': 'Stacy, Yearbook Captain',
                'pic': '{% static 'img/yearbook_stacy.png' %}',
                'id': 1000424,
                'can_sign': false
            };
            var signTemplate = $('#sign_template').html();
            $('.signs_list').append(Mustache.to_html(signTemplate, s1))
                    .append(Mustache.to_html(signTemplate, s2));

            // Inject two dummy yearbooks
            var yb1 = {
                'first_name': 'Ethan',
                'name': 'Ethan Montoya',
                'pic': '{% static 'img/yearbook_stacy.png' %}',
                'id': 1000424
            };
            var yb2 = {
                'first_name': 'Ethan',
                'first': 'Ethan Montoya',
                'pic': '{% static 'img/yearbook_stacy.png' %}',
                'id': 1000424
            };
            var yearbookTemplate = $('#yearbook_template').html();
            $('.yearbooks_list').append(Mustache.to_html(yearbookTemplate, yb1))
                    .append(Mustache.to_html(yearbookTemplate, yb2));

            $('.yearbook_input').focus(function(e){
                var input = $(e.target);
                var yearbook = input.parents('.yearbook');
                // Show name label
                yearbook.find('.yearbook_name').slideDown(500);
                // Slide open textarea
                input.animate({height: '122px'}, 800);
                // Slide open footer
                yearbook.find('.yearbook_footer').slideDown(500);
            });
            $('.yearbook_input').blur(function(e) {
                var input = $(e.target);
                var yearbook = input.parents('.yearbook');
                // Hide name label if they haven't typed anything
                if (!input.val().length) {
                    yearbook.find('.yearbook_name').slideUp(500);
                }
                // Slide back textarea
                input.animate({height: '40px'}, 500);
                input.scrollTop(0);
                // Slide footer closed
                yearbook.find('.yearbook_footer').slideUp(500);
            });
            $('.signYearbookButton').click(function(){
                // Collapse the yearbook and show the loading spinner

                // Submit the yearbook sign

                // Show the post to wall dialog
            });
        });
    </script>
{#    <script type="text/javascript" src="{% static 'js/sign_friends.js' %}"></script>#}
{% endblock %}
